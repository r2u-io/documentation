/**
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/* Inspired by NProgress <http://ricostacruz.com/nprogress> */
import React, { useEffect, useState } from 'react';
import clsx from 'clsx';
import styles from './styles.module.css';
const MAX_VAL = 0.994;
function ProgressBar({ finished }) {
    const [progress, setProgress] = useState(0.08);
    const [timeoutId, setTimeoutId] = useState(null);
    const [done, setDone] = useState(false);
    const increaseProgress = () => {
        let randomAmount = progress + Math.random() * 0.02;
        if (randomAmount > MAX_VAL) {
            randomAmount = MAX_VAL;
        }
        console.log(randomAmount); //
        setProgress(randomAmount);
    };
    // useEffect(() => {
    //   console.log(111);
    //   nprogress.start();
    // }, []);
    useEffect(() => {
        if (progress >= MAX_VAL) {
            return;
        }
        const timeoutId = window.setTimeout(increaseProgress, 800);
        setTimeoutId(timeoutId);
    }, [progress]);
    useEffect(() => {
        if (!finished) {
            return;
        }
        console.log('FINISH');
        if (timeoutId) {
            window.clearTimeout(timeoutId);
            setTimeoutId(null);
        }
        setProgress(1);
        // For smooth fade-out effect.
        setTimeout(function () {
            setDone(true);
        }, 300);
    }, [finished]);
    if (done) {
        return null;
    }
    return (React.createElement("div", { className: clsx(styles.progressBar, {
            [styles.progressBarFinished]: finished,
        }), role: "bar", style: {
            transform: `translate3d(${(progress - 1) * 100}%, 0, 0`,
        } },
        React.createElement("div", { className: clsx(styles.progressBarPeg) })));
}
export default ProgressBar;
